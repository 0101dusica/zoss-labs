# Exploit 4 (Teorijski) - DoS nad Mosquitto brokerom kroz crafted CONNECT packet (CVE-2017-7651)

## 0. Kratak opis

Eclipse Mosquitto broker je u određenim verzijama imao ranjivost u kojoj neautentifikovani klijent može poslati crafted CONNECT paket koji uzrokuje prekomernu potrošnju memorije. Ponovljeni zahtevi i veći broj malicioznih konekcija mogu dovesti do Out Of Memory stanja, usporavanja sistema ili ubijanja brokera od strane operativnog sistema.

U kontekstu UrbanSense, MQTT broker predstavlja centralnu tačku prijema senzorskih podataka. Napad na broker direktno ugrožava dostupnost celog sistema, jer prekida komunikaciju između senzora i backend servisa.

Ovaj napad je teorijski u okviru KT3, jer zavisi od specifične verzije Mosquitto brokera, ali je zasnovan na realnom CVE zapisu i vendor advisory-ju.

---

## 1. Pogođene komponente

- MQTT broker (Eclipse Mosquitto)
- Senzorski sloj (publish) i backend sloj (subscribe) indirektno, jer ostaju bez transporta poruka

---

## 2. Bezbednosni ciljevi i osetljivi resursi

### Primarni narušeni cilj
- **Availability (Dostupnost):** broker postaje spor, nedostupan ili se ruši.

### Sekundarni efekti
- **Integrity (Integritet):** gubitak poruka i “gap” u vremenskim serijama merenja.
- **Operational impact:** prekid alarmiranja i agregacije podataka.

---

## 3. Ranjivost

### Suština ranjivosti
Neautentifikovani klijenti mogu poslati crafted CONNECT paket koji izaziva veliku potrošnju memorije u brokeru. Ponavljanjem ovog postupka, posebno paralelno sa više konekcija, broker može ostati bez memorije i prestati sa radom.

### Identifikator ranjivosti
- **CVE-2017-7651**

---

## 4. Pretnja i scenario napada

### Pretnja
Napadač koristi ranjivost u fazi konekcije (CONNECT) da bi izazvao iscrpljivanje memorije na brokeru.

### Preduslovi
- Broker verzija je u opsegu ranjivih verzija navedenih u vendor advisory-ju.
- Broker je mrežno dostupan napadaču.
- Ne postoji adekvatan network-level limit (npr. firewall/IPS) ili ograničenje konekcija.

### Tok napada (high-level)
1. Napadač uspostavlja konekciju sa brokerom.
2. Napadač šalje crafted CONNECT paket koji izaziva prekomernu alokaciju memorije.
3. Napadač ponavlja postupak kroz više konekcija.
4. Broker postaje neodgovarajući ili se ruši zbog OOM stanja.

---

## 5. Očekivani rezultat (dokaz uspeha)

U realnom okruženju, uspeh napada bi se dokazivao kroz:
- rast memorijske potrošnje procesa brokera,
- degradaciju brzine obrade poruka,
- prekid konekcija senzora i subscriber-a,
- crash brokera ili kill od strane OS-a.

---

## 6. Mitigacija (teorijski)

Mitigacija uključuje:
- ažuriranje Mosquitto brokera na verziju u kojoj je ranjivost ispravljena (prema vendor advisory-ju),
- ograničavanje broja konekcija i rate limiting na nivou mreže (firewall),
- izolaciju brokera (privatna mreža, minimalno izlaganje portova),
- autentifikaciju i ACL kao dodatni zaštitni sloj (iako CVE opisuje neautentifikovani scenario).

---

## 7. Reference

- [Mosquitto security advisory: CVE-2017-7651, CVE-2017-7652](https://mosquitto.org/blog/2018/02/security-advisory-cve-2017-7651-cve-2017-7652/)
- [NVD: CVE-2017-7651](https://nvd.nist.gov/vuln/detail/CVE-2017-7651)
- [Mosquitto security page (lista ranjivosti i fix verzija)](https://mosquitto.org/security/)