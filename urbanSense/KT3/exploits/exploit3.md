# Exploit 3 (Teorijski) - HTTP Request Smuggling u Go net/http (CVE-2025-22871)

## 0. Kratak opis

U određenim verzijama Go standardne biblioteke, paket `net/http` prihvata neispravnu varijantu terminatora linije (bare LF) u okviru chunked transfer encoding formata. U kombinaciji sa određenim proxy serverima ili posrednim komponentama koje različito interpretiraju chunk-ext deo, ovaj “parser mismatch” može omogućiti HTTP request smuggling.

U kontekstu UrbanSense sistema, ova pretnja postaje relevantna u scenariju gde Go API radi iza reverse proxy-ja ili gateway-a (npr. Nginx, API gateway, load balancer), ili gde postoji više hop-ova obrade HTTP zahteva.

Ovaj napad je teorijski u okviru KT3 jer zahteva specifičan deployment (kombinacija više komponenti i određene verzije Go runtime-a), ali je baziran na realnom CVE zapisu i poznatom obrascu napada.

---

## 1. Pogođene komponente

- Go HTTP server (`net/http`)
- Reverse proxy / gateway / load balancer (posredni sloj)
- API endpoint-i UrbanSense sistema (npr. ingest ili read-only API)

---

## 2. Bezbednosni ciljevi i osetljivi resursi

### Primarni narušeni ciljevi
- **Integrity (Integritet):** moguće ubacivanje dodatnih “skrivenih” zahteva koji prolaze mimo očekivanog toka obrade.
- **Authorization bypass (sekundarno):** potencijalno zaobilaženje kontrola pristupa ako proxy i backend različito “vide” granice zahteva.

### Sekundarni efekti
- **Confidentiality (Poverljivost):** curenje informacija kroz neautorizovane zahteve.
- **Availability (Dostupnost):** destabilizacija i nepredvidivo ponašanje servisa pod malicioznim input-om.

---

## 3. Ranjivost

### Suština ranjivosti
Ranjivost nastaje zbog neusklađenog parsiranja HTTP poruka između proxy sloja i backend sloja. Kada proxy interpretira zahtev na jedan način, a backend (Go `net/http`) na drugi, napadač može “progurati” dodatni zahtev unutar iste TCP konekcije. Backend može obraditi taj dodatni zahtev kao zaseban, dok proxy smatra da je i dalje u okviru prvog zahteva.

### Identifikator ranjivosti
- **CVE-2025-22871** (Go `net/http`)  
- **GO-2025-3563** (Go Vulnerability Database)

---

## 4. Pretnja i scenario napada

### Pretnja
Napadač šalje specijalno formiran HTTP zahtev koji koristi parser mismatch (chunked encoding) da bi izazvao da backend obradi dodatni “skriveni” request.

### Preduslovi
- UrbanSense Go API radi iza proxy servera ili gateway-a.
- Koristi se ranjiva verzija Go standardne biblioteke (relevantne verzije zavise od advisory-ja).
- Postoji neusklađenost u tumačenju nevalidnog chunked formata između proxy-a i backend-a.

### Tok napada (high-level)
1. Napadač uspostavlja konekciju ka proxy sloju.
2. Napadač šalje crafted chunked request koji proxy parsira drugačije od backend-a.
3. Backend interpretira deo toka kao drugi zaseban request.
4. “Smuggled” request se obrađuje u backend-u mimo očekivanih kontrola.

---

## 5. Očekivani rezultat (dokaz uspeha)

U realnom okruženju, uspeh napada bi se dokazivao kroz:
- neočekivane zahteve u backend logovima (zahtevi koji ne postoje u proxy logovima),
- anomalije u request id korelaciji između gateway logova i aplikacionih logova,
- izvršavanje akcija mimo očekivanog routing-a ili validacije na proxy sloju.

---

## 6. Mitigacija (teorijski)

Mitigacija se ostvaruje kombinacijom:
- ažuriranja Go verzije na fix verziju (prema Go advisory-ju),
- striktne validacije HTTP parsiranja i onemogućavanja “lenient” ponašanja,
- pravilnog podešavanja reverse proxy-ja (dosledno parsiranje i sanitizacija),
- ograničavanja reuse konekcija za osetljive rute (po potrebi),
- centralizovanog logovanja i korelacije (proxy log + app log).

---

## 7. Reference

- [NVD: CVE-2025-22871](https://nvd.nist.gov/vuln/detail/CVE-2025-22871)
- [Go Vulnerability Database: GO-2025-3563](https://pkg.go.dev/vuln/GO-2025-3563)
- [Go issue (referencirano u CVE zapisu)](https://go.dev/issue/71988)